<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#050b14">
    <title>Finance √âlite 360</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: { deep: '#050b14', gold: '#d4af37' },
                    backgroundImage: {
                        'gold-grad': 'linear-gradient(135deg, #FFD700 0%, #d4af37 100%)',
                        'dark-grad': 'linear-gradient(to bottom, #050b14, #0a1120)'
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #050b14; color: #e2e8f0; overscroll-behavior-y: none; }
        
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-high { background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-nav { background: rgba(5, 11, 20, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.05); }
        
        .input-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 14px 16px; width: 100%; max-width: 100%; color: white; outline: none; transition: 0.3s; font-size: 14px; display: block; min-width: 0; }
        .input-box:focus { border-color: rgba(212, 175, 55, 0.5); background: rgba(255,255,255,0.05); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-up { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        input[type="date"], input[type="month"], input[type="datetime-local"] { color-scheme: dark; width: 100%; min-width: 0; appearance: none; -webkit-appearance: none; padding-right: 10px; }
        .nav-active { color: #d4af37; opacity: 1; transform: scale(1.1); text-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }
        .nav-inactive { color: #64748b; opacity: 0.7; }

        /* Lock Screen */
        #lock-screen { position: fixed; inset: 0; z-index: 9999; background: #050b14; display: flex; flex-col; align-items: center; justify-content: center; padding: 24px; transition: opacity 0.5s ease; }
        .hidden-content { display: none; }

        /* --- ESTILOS DE IMPRESI√ìN PDF --- */
        #printable-area { display: none; }
        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area { display: block; position: absolute; left: 0; top: 0; width: 100%; background: white; color: black; padding: 20px; font-family: 'Helvetica', sans-serif; }
            .text-white { color: black !important; }
            .bg-dark-grad { background: white !important; }
            .glass, .glass-high { background: none !important; border: 1px solid #ddd !important; backdrop-filter: none !important; color: black !important; }
        }
    </style>
</head>
<body class="pb-32 bg-dark-grad min-h-screen text-sm">

    <div id="lock-screen">
        <div class="text-center mb-8 animate-up">
            <div class="w-20 h-20 rounded-full bg-gold-grad flex items-center justify-center text-slate-900 font-bold text-4xl shadow-lg shadow-gold/20 mx-auto mb-6">F</div>
            <h1 class="text-2xl font-bold text-white mb-2">Finance √âlite 360</h1>
            <p class="text-slate-400 text-xs tracking-widest uppercase">Sistema Premium</p>
        </div>
        <div class="glass p-6 rounded-3xl w-full max-w-sm border-t border-white/10 animate-up">
            <p class="text-[10px] font-bold text-slate-500 uppercase mb-2 text-center">ID de Dispositivo</p>
            <div id="displayDeviceID" class="bg-white/5 p-4 rounded-xl text-center text-xl font-mono text-gold font-bold mb-6 select-all border border-gold/10 tracking-widest">...</div>
            <p class="text-[10px] font-bold text-slate-500 uppercase mb-2 text-center">Clave de Activaci√≥n</p>
            <input type="text" id="inputKey" placeholder="XXXX-XXXX" class="input-box text-center uppercase tracking-widest mb-4 font-mono text-lg">
            <button onclick="validarYEntrar()" class="w-full bg-gold-grad text-black py-4 rounded-2xl font-bold uppercase tracking-widest text-xs shadow-lg shadow-gold/20 active:scale-[0.98] transition-transform">Desbloquear</button>
            <p id="lockError" class="text-red-500 text-xs text-center mt-4 hidden font-bold">Clave incorrecta</p>
        </div>
    </div>

    <div id="printable-area"></div>

    <div id="app-container" class="hidden-content">
        <div id="app" class="max-w-md mx-auto relative min-h-screen"></div>
        <nav id="main-nav" class="fixed bottom-0 left-0 right-0 px-6 py-4 pb-8 flex justify-around items-center z-50 glass-nav max-w-md mx-auto"></nav>
    </div>

    <script>
        // --- SEGURIDAD ---
        const SALT_SECRETA = "FINANCE_ELITE_2026_V1"; 
        let deviceID = localStorage.getItem('fe360_device_id');
        if (!deviceID) {
            const part1 = Math.random().toString(36).substring(2, 6).toUpperCase();
            const part2 = Math.random().toString(36).substring(2, 4).toUpperCase();
            deviceID = `${part1}-${part2}`;
            localStorage.setItem('fe360_device_id', deviceID);
        }
        document.getElementById('displayDeviceID').innerText = deviceID;

        function generarHash(input) {
            let str = input + SALT_SECRETA; let hash = 0;
            for (let i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash = hash & hash; }
            const hex = Math.abs(hash).toString(16).toUpperCase().padStart(8, '0'); 
            return hex.substring(0, 4) + '-' + hex.substring(4, 8);
        }

        function validarYEntrar() {
            if (document.getElementById('inputKey').value.trim().toUpperCase() === generarHash(deviceID)) {
                localStorage.setItem('fe360_activated', 'true'); abrirApp();
            } else { document.getElementById('lockError').classList.remove('hidden'); }
        }

        function abrirApp() {
            document.getElementById('lock-screen').style.display = 'none';
            const content = document.getElementById('app-container');
            content.classList.remove('hidden-content');
            content.classList.add('animate-up');
            render(); renderNav();
        }

        if (localStorage.getItem('fe360_activated') === 'true') abrirApp();

        // --- APP LOGIC ---
        let config = JSON.parse(localStorage.getItem('e360_config')) || { nombre: "Usuario", metodos: [{nombre:'Efectivo',tipo:'debito',inicial:0},{nombre:'Amex',tipo:'credito',inicial:0}], categorias: ['Comida','Gasolina'], conceptosIngreso: ['N√≥mina'], recurrentes: [], metas: [] };
        let movimientos = JSON.parse(localStorage.getItem('e360_movs')) || [];
        let vistaActual = 'home'; let tipoActual = 'gasto'; let subVistaCorte = 'semana';
        const now = new Date(); now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        let fechaFiltroCorte = now.toISOString().slice(0, 10);

        function render() {
            const c = document.getElementById('app');
            if (vistaActual === 'corte') renderCorte(c);
            else if (vistaActual === 'metas') renderMetas(c);
            else if (vistaActual === 'config') renderConfig(c);
            else renderHome(c);
            renderNav();
        }

        function renderNav() {
            const nav = document.getElementById('main-nav');
            const items = [{id:'home',icon:'üè†',l:'Inicio'},{id:'corte',icon:'üìä',l:'Corte'},{id:'metas',icon:'üéØ',l:'Metas'},{id:'config',icon:'‚öôÔ∏è',l:'Ajustes'}];
            nav.innerHTML = items.map((i,idx) => {
                return `<button onclick="cambiarVista('${i.id}')" class="flex flex-col items-center gap-1.5 transition-all duration-300 ${vistaActual===i.id?'nav-active':'nav-inactive'}"><span class="text-2xl">${i.icon}</span><span class="text-[9px] font-bold uppercase tracking-widest">${i.l}</span></button>${idx===1?'<div class="w-px h-8 bg-white/10 mx-2"></div>':''}`;
            }).join('');
        }

        // --- VISTAS ---
        function renderHome(c) {
            const stats = calcularGlobal();
            c.innerHTML = `
                <div class="pt-14 px-6 mb-8 animate-up">
                    <div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 rounded-full bg-gold-grad flex items-center justify-center text-slate-900 font-bold text-lg shadow-lg shadow-gold/20">F</div><div><p class="text-[10px] font-bold text-gold uppercase tracking-[0.2em] mb-0.5">Bienvenido</p><h3 class="text-lg font-semibold text-white leading-none">${config.nombre}</h3></div></div>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Patrimonio Neto (Real)</p><h2 class="text-6xl font-extrabold text-white tracking-tighter mb-4">$${stats.totalBalance.toLocaleString()}</h2>
                </div>
                <div class="px-6 space-y-8 animate-up">
                    ${config.recurrentes.length>0 ? `<button onclick="procesarRecurrentes()" class="w-full glass py-3 rounded-2xl font-bold text-xs uppercase text-slate-300 flex items-center justify-center gap-2 hover:bg-white/5 active:scale-[0.98] transition-all border border-gold/20"><span>‚ôªÔ∏è</span> Procesar Suscripciones</button>`:''}
                    <div class="overflow-x-auto no-scrollbar flex gap-4 pb-4 -mx-6 px-6">${config.metodos.map(m => { const data = stats.detalles[m.nombre]||{bal:m.inicial||0,in:0,out:0}; const isCred=m.tipo==='credito'; return `<div class="min-w-[170px] glass-high rounded-3xl p-5 flex flex-col justify-between h-44 relative overflow-hidden"><div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br ${isCred?'from-red-500/20':'from-emerald-500/20'} to-transparent rounded-bl-full -mr-4 -mt-4 blur-xl"></div><div class="flex justify-between items-start z-10"><div class="flex flex-col"><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-1">${isCred?'Cr√©dito':'D√©bito'}</span><span class="text-sm font-bold text-white uppercase truncate w-28">${m.nombre}</span></div><div class="w-7 h-7 rounded-full ${isCred?'bg-red-500/10 text-red-400':'bg-emerald-500/10 text-emerald-400'} flex items-center justify-center text-xs">${isCred?'üí≥':'üè¶'}</div></div><div class="z-10"><p class="text-[10px] text-slate-400 uppercase mb-1">${isCred?'Deuda Total':'Disponible'}</p><p class="text-xl font-bold text-white mb-3 tracking-tight">$${Math.abs(data.bal).toLocaleString()}</p><div class="flex gap-2 text-[9px] font-bold"><span class="text-emerald-400">‚Üì $${data.in.toLocaleString()}</span><span class="text-red-400">‚Üë $${data.out.toLocaleString()}</span></div></div></div>`; }).join('')}</div>
                    <div class="glass rounded-[30px] p-6 shadow-2xl relative border-t border-white/10">
                        <div class="flex bg-black/20 rounded-2xl p-1.5 mb-6 border border-white/5"><button onclick="tipoActual='gasto'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold uppercase transition-all ${tipoActual==='gasto'?'bg-white text-black shadow-lg':'text-slate-400'}">Gasto</button><button onclick="tipoActual='ingreso'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold uppercase transition-all ${tipoActual==='ingreso'?'bg-white text-black shadow-lg':'text-slate-400'}">Ingreso</button><button onclick="tipoActual='abono'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold uppercase transition-all ${tipoActual==='abono'?'bg-gold-grad text-black shadow-lg':'text-slate-400'}">Abonar</button></div>
                        <div class="relative mb-6"><span class="absolute top-1/2 -translate-y-1/2 left-0 text-3xl font-light text-slate-500">$</span><input type="number" id="monto" inputmode="decimal" placeholder="0.00" class="w-full bg-transparent text-5xl font-bold text-white text-center outline-none placeholder:text-slate-700 py-2"></div>
                        <div class="grid grid-cols-2 gap-4 mb-4">${tipoActual==='abono'?`<div class="space-y-1"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2">Origen</label><select id="metodo_origen" class="input-box bg-deep">${config.metodos.filter(x=>x.tipo==='debito').map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select></div><div class="space-y-1"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2">Destino</label><select id="metodo" class="input-box bg-deep">${config.metodos.filter(x=>x.tipo==='credito').map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select></div>`:`<div class="space-y-1"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2">Concepto</label><select id="cat" class="input-box bg-deep">${(tipoActual==='gasto'?config.categorias:config.conceptosIngreso).map(c=>`<option value="${c}">${c}</option>`)}</select></div><div class="space-y-1"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2">Cuenta</label><select id="metodo" class="input-box bg-deep">${config.metodos.map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select></div>`}</div>
                        <div class="mb-4"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2 mb-1 block">Fecha y Hora</label><input type="datetime-local" id="fecha_mov" class="input-box bg-deep text-sm w-full"></div>
                        <div class="mb-6"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2 mb-1 block">Nota</label><input type="text" id="desc" placeholder="Opcional..." class="input-box bg-deep text-sm w-full"></div>
                        <button onclick="registrar()" class="w-full bg-gold-grad text-black py-4 rounded-2xl font-bold uppercase tracking-widest text-xs shadow-lg active:scale-[0.98] transition-transform">Confirmar</button>
                    </div>
                </div>`;
            const n = new Date(); n.setMinutes(n.getMinutes() - n.getTimezoneOffset());
            document.getElementById('fecha_mov').value = n.toISOString().slice(0, 16);
        }

        function renderCorte(c) {
            const data = calcularCorte(subVistaCorte, fechaFiltroCorte);
            c.innerHTML = `
                <div class="pt-14 px-6 fade-in pb-32">
                    <h1 class="text-2xl font-bold text-white mb-8 text-center uppercase tracking-widest">Auditor√≠a <span class="text-gold">Pro</span></h1>
                    <div class="glass p-1.5 rounded-xl flex justify-between mb-8"><button onclick="subVistaCorte='dia'; render();" class="flex-1 py-2.5 rounded-lg text-[10px] font-bold uppercase transition-all ${subVistaCorte==='dia'?'bg-white text-black shadow':'text-slate-400'}">D√≠a</button><button onclick="subVistaCorte='semana'; render();" class="flex-1 py-2.5 rounded-lg text-[10px] font-bold uppercase transition-all ${subVistaCorte==='semana'?'bg-white text-black shadow':'text-slate-400'}">Semana</button><button onclick="subVistaCorte='mes'; render();" class="flex-1 py-2.5 rounded-lg text-[10px] font-bold uppercase transition-all ${subVistaCorte==='mes'?'bg-white text-black shadow':'text-slate-400'}">Mes</button></div>
                    <div class="mb-2 w-full"><label class="text-[9px] font-bold text-slate-500 uppercase ml-2 mb-1 block">Periodo de An√°lisis</label><div class="w-full"><input type="${subVistaCorte==='mes'?'month':'date'}" value="${fechaFiltroCorte.slice(0, subVistaCorte==='mes'?7:10)}" onchange="fechaFiltroCorte=this.value; render();" class="input-box bg-deep text-center font-bold text-lg border-white/10 w-full"></div></div>
                    <p class="text-center text-[10px] text-gold font-bold mb-8 uppercase tracking-widest opacity-80 border-b border-gold/10 pb-4">${data.rangoTexto}</p>
                    
                    <div class="flex gap-3 mb-8">
                        <button onclick="exportarReporte()" class="flex-1 border border-white/10 bg-white/5 py-3 rounded-xl text-xs font-bold uppercase text-slate-300 hover:bg-white/10 transition flex items-center justify-center gap-2">üìÑ PDF / Imprimir</button>
                        <button onclick="exportarExcel()" class="flex-1 border border-emerald-500/20 bg-emerald-500/10 py-3 rounded-xl text-xs font-bold uppercase text-emerald-400 hover:bg-emerald-500/20 transition flex items-center justify-center gap-2">üìä Excel</button>
                    </div>

                    <div class="glass-high rounded-3xl p-6 mb-8 text-center relative overflow-hidden"><div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-1 bg-gold/50 rounded-b-full shadow-[0_0_20px_rgba(212,175,55,0.5)]"></div><p class="text-[10px] text-slate-400 font-bold uppercase mb-2 tracking-widest">Flujo Neto</p><h3 class="text-5xl font-bold text-white tracking-tight mb-6">$${data.neto.toLocaleString()}</h3><div class="grid grid-cols-2 gap-4 border-t border-white/5 pt-4"><div><p class="text-[9px] text-emerald-400 uppercase font-bold mb-1">Ingresos</p><p class="text-xl font-bold text-white">$${data.ingresos.toLocaleString()}</p></div><div class="border-l border-white/5"><p class="text-[9px] text-red-400 uppercase font-bold mb-1">Gastos</p><p class="text-xl font-bold text-white">$${data.gastos.toLocaleString()}</p></div></div></div>
                    <div><h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4 tracking-widest ml-2">Historial</h3><div class="space-y-3">${data.lista.length===0?'<div class="text-center py-10 opacity-30"><p class="text-4xl mb-2">üçÉ</p><p class="text-xs uppercase font-bold">Sin movimientos</p></div>':''} ${data.lista.map(m=>`<div class="glass p-4 rounded-2xl flex justify-between items-center group hover:bg-white/5 transition-colors"><div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="w-1.5 h-1.5 rounded-full ${m.tipo==='ingreso'?'bg-emerald-400':'bg-red-400'}"></span><p class="text-xs font-bold text-white">${m.cat}</p></div><p class="text-[10px] text-slate-400">${m.desc||'Sin nota'} <span class="text-slate-600 mx-1">‚Ä¢</span> ${m.metodo}</p></div><div class="text-right ml-4"><p class="text-sm font-bold ${m.tipo==='ingreso'?'text-emerald-400':'text-white'}">$${parseFloat(m.monto).toLocaleString()}</p><div class="flex justify-end gap-3 mt-2 opacity-60 group-hover:opacity-100 transition-opacity"><button onclick="editarMovimiento(${m.index})" class="text-[9px] text-gold font-bold uppercase">Editar</button><button onclick="eliminarMovimiento(${m.index})" class="text-[9px] text-red-500 font-bold uppercase">Borrar</button></div></div></div>`).join('')}</div></div>
                </div>`;
        }

        function renderMetas(c) {
            c.innerHTML = `
                <div class="pt-14 px-6 animate-up pb-32">
                    <h1 class="text-2xl font-bold text-white mb-8 text-center uppercase tracking-widest">Mis Objetivos</h1>
                    <div class="glass rounded-[30px] p-6 mb-8 border-t border-white/10">
                        <div class="space-y-4">
                            <input type="text" id="meta_nombre" placeholder="Nombre de la Meta" class="input-box bg-deep">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="number" id="meta_monto" placeholder="Monto $" class="input-box bg-deep">
                                <div><label class="text-[9px] font-bold text-gold uppercase ml-1 block mb-1">Fecha L√≠mite</label><input type="date" id="meta_fecha" class="input-box bg-deep text-xs w-full"></div>
                            </div>
                            <div class="flex gap-3 pt-2"><button onclick="agregarMeta('ahorro')" class="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold uppercase text-[10px] border border-white/5 hover:bg-slate-700">Ahorro ‚úàÔ∏è</button><button onclick="agregarMeta('deuda')" class="flex-1 bg-red-900/30 text-red-200 py-3 rounded-xl font-bold uppercase text-[10px] border border-red-500/20 hover:bg-red-900/50">Deuda üìâ</button></div>
                        </div>
                    </div>
                    <div class="space-y-4">${config.metas.map((m, i) => `<div class="glass p-5 rounded-2xl border-l-4 ${m.tipo==='deuda'?'border-red-500':'border-gold'} relative overflow-hidden"><div class="flex justify-between items-start relative z-10"><div><h4 class="font-bold text-lg text-white mb-1">${m.nombre}</h4><p class="text-[10px] text-slate-400 uppercase tracking-wider">Meta: $${parseFloat(m.monto).toLocaleString()}</p></div><div class="text-right"><p class="text-[9px] font-bold bg-white/10 px-2 py-1 rounded text-white">${m.fecha}</p><button onclick="borrarMeta(${i})" class="text-red-500 text-[9px] font-bold uppercase mt-3">Eliminar</button></div></div></div>`).join('')}</div>
                </div>`;
        }

        function renderConfig(c) {
            c.innerHTML = `
                <div class="pt-14 px-6 animate-up pb-32">
                    <h1 class="text-2xl font-bold text-white mb-8 text-center uppercase tracking-widest">Configuraci√≥n</h1>
                    <div class="mb-10"><h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3 ml-2 tracking-widest">Identidad</h3><div class="glass p-4 rounded-2xl"><label class="text-[9px] font-bold text-slate-400 uppercase block mb-2">Titular</label><input type="text" id="titularNom" value="${config.nombre}" onchange="updateNombre(this.value)" class="input-box bg-deep font-bold"></div></div>
                    <div class="mb-10"><h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3 ml-2 tracking-widest">Cartera & Activos</h3><div class="glass p-5 rounded-3xl space-y-5"><div class="bg-white/5 p-4 rounded-xl border border-white/5"><p class="text-[9px] font-bold text-white uppercase mb-3 text-center">A√±adir Nueva Cuenta</p><div class="space-y-3"><div class="grid grid-cols-2 gap-2"><input type="text" id="newCta" placeholder="Nombre" class="input-box bg-deep text-xs"><select id="ctaTipo" class="input-box bg-deep text-xs"><option value="debito">D√©bito</option><option value="credito">Cr√©dito</option></select></div><div class="flex gap-2"><input type="number" id="ctaInicial" placeholder="Saldo Inicial $" class="input-box bg-deep text-xs flex-1"><button onclick="addItemMetodo()" class="bg-white text-black px-5 rounded-xl font-bold uppercase text-[10px] hover:bg-gray-200">Crear</button></div></div></div><div class="space-y-2">${config.metodos.map((m, i) => `<div class="flex justify-between items-center bg-deep p-3 rounded-xl border border-white/5"><div><p class="text-xs font-bold text-white">${m.nombre} <span class="text-[9px] text-slate-500 ml-1">(${m.tipo === 'credito' ? 'CR' : 'DB'})</span></p><p class="text-[9px] text-gold/80">Inicial: $${parseFloat(m.inicial || 0).toLocaleString()}</p></div><div class="flex gap-3"><button onclick="editarCuenta(${i})" class="text-[9px] font-bold text-slate-300 uppercase">Editar</button><button onclick="removeItem('metodos',${i})" class="text-[9px] font-bold text-red-500 uppercase">√ó</button></div></div>`).join('')}</div></div></div>
                    <div class="mb-10"><h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3 ml-2 tracking-widest">Conceptos</h3><div class="glass p-5 rounded-3xl mb-4"><p class="text-[9px] font-bold text-emerald-400 uppercase mb-3">Fuentes de Ingreso</p><div class="flex gap-2 mb-4"><input type="text" id="newIngreso" placeholder="Ej: Freelance" class="input-box bg-deep text-xs"><button onclick="addItem('conceptosIngreso', 'newIngreso')" class="bg-emerald-500/20 text-emerald-400 px-4 rounded-xl font-bold border border-emerald-500/20">+</button></div><div class="flex flex-wrap gap-2">${config.conceptosIngreso.map((c,i)=>`<span class="bg-emerald-500/10 text-emerald-300 px-3 py-1.5 rounded-lg text-[9px] font-bold border border-emerald-500/10 flex items-center gap-2">${c} <button onclick="removeItem('conceptosIngreso',${i})">√ó</button></span>`).join('')}</div></div><div class="glass p-5 rounded-3xl"><p class="text-[9px] font-bold text-red-400 uppercase mb-3">Categor√≠as de Gasto</p><div class="flex gap-2 mb-4"><input type="text" id="newCat" placeholder="Ej: Renta" class="input-box bg-deep text-xs"><button onclick="addItem('categorias', 'newCat')" class="bg-red-500/20 text-red-400 px-4 rounded-xl font-bold border border-red-500/20">+</button></div><div class="flex flex-wrap gap-2">${config.categorias.map((c,i)=>`<span class="bg-red-500/10 text-red-300 px-3 py-1.5 rounded-lg text-[9px] font-bold border border-red-500/10 flex items-center gap-2">${c} <button onclick="removeItem('categorias',${i})">√ó</button></span>`).join('')}</div></div></div>
                    <div class="mb-10"><h3 class="text-[10px] font-bold text-slate-500 uppercase mb-3 ml-2 tracking-widest">Recurrentes</h3><div class="glass p-5 rounded-3xl"><div class="grid grid-cols-4 gap-2 mb-2"><input type="text" id="recNom" placeholder="Netflix" class="col-span-2 input-box bg-deep text-xs"><input type="number" id="recMon" placeholder="$" class="col-span-1 input-box bg-deep text-xs"><input type="number" id="recDia" placeholder="D√≠a" min="1" max="31" class="col-span-1 input-box bg-deep text-xs text-center"></div><select id="recCta" class="w-full input-box bg-deep text-xs mb-3">${config.metodos.map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select><button onclick="addRecurrente()" class="w-full bg-white text-black py-3 rounded-xl font-bold text-[10px] uppercase hover:bg-gray-200">Guardar Suscripci√≥n</button><div class="mt-4 space-y-2">${config.recurrentes.map((r, i) => `<div class="flex justify-between items-center bg-deep p-3 rounded-xl border border-white/5"><span class="text-[10px] font-bold text-slate-300">üìÖ D√≠a ${r.dia} ‚Ä¢ ${r.nombre} ($${r.monto})</span><button onclick="removeItem('recurrentes',${i})" class="text-red-400 text-xs font-bold px-2">√ó</button></div>`).join('')}</div></div></div>
                    <button onclick="if(confirm('¬øBorrar todo?')){localStorage.clear();location.reload();}" class="w-full text-red-500/50 font-bold uppercase text-[9px] pb-8 hover:text-red-500 transition-colors">‚ö†Ô∏è Restablecer F√°brica</button>
                </div>`;
        }

        // --- EXPORTAR PDF ---
        function exportarReporte() {
            const data = calcularCorte(subVistaCorte, fechaFiltroCorte);
            const div = document.getElementById('printable-area');
            
            div.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 20px;">
                        <div>
                            <h1 style="margin: 0; font-size: 24px; font-weight: 800; text-transform: uppercase;">Finance √âlite 360</h1>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 12px;">Reporte Ejecutivo Financiero</p>
                        </div>
                        <div style="text-align: right;">
                            <p style="margin: 0; font-weight: bold; font-size: 14px;">${config.nombre}</p>
                            <p style="margin: 0; color: #666; font-size: 12px;">Generado: ${new Date().toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="margin-top: 0; text-transform: uppercase; font-size: 12px; color: #666; letter-spacing: 1px;">Resumen del Periodo</h3>
                        <p style="font-weight: bold; margin-bottom: 15px;">${data.rangoTexto}</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                            <div><p style="margin: 0; font-size: 10px; text-transform: uppercase;">Ingresos</p><p style="margin: 5px 0 0 0; color: green; font-weight: bold; font-size: 18px;">+$${data.ingresos.toLocaleString()}</p></div>
                            <div><p style="margin: 0; font-size: 10px; text-transform: uppercase;">Gastos</p><p style="margin: 5px 0 0 0; color: red; font-weight: bold; font-size: 18px;">-$${data.gastos.toLocaleString()}</p></div>
                            <div><p style="margin: 0; font-size: 10px; text-transform: uppercase;">Neto</p><p style="margin: 5px 0 0 0; font-weight: bold; font-size: 18px;">$${data.neto.toLocaleString()}</p></div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr style="border-bottom: 1px solid #ddd; text-align: left;">
                                <th style="padding: 10px; text-transform: uppercase; color: #666;">Fecha</th>
                                <th style="padding: 10px; text-transform: uppercase; color: #666;">Concepto</th>
                                <th style="padding: 10px; text-transform: uppercase; color: #666;">M√©todo</th>
                                <th style="padding: 10px; text-transform: uppercase; color: #666; text-align: right;">Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.lista.map(m => `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 12px 10px; color: #333;">${m.fecha.replace('T', ' ')}</td>
                                    <td style="padding: 12px 10px;"><b>${m.cat}</b><br><span style="color: #888; font-size: 10px;">${m.desc||''}</span></td>
                                    <td style="padding: 12px 10px; color: #555;">${m.metodo}</td>
                                    <td style="padding: 12px 10px; text-align: right; font-weight: bold; color: ${m.tipo==='ingreso'?'green':'red'};">${m.tipo==='ingreso'?'+':'-'}$${parseFloat(m.monto).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div style="margin-top: 50px; text-align: center; border-top: 1px solid #eee; padding-top: 20px;">
                        <p style="font-size: 10px; color: #999;">Documento generado autom√°ticamente por Finance √âlite 360.</p>
                    </div>
                </div>
            `;
            window.print();
        }

        // --- EXPORTAR EXCEL (CSV) ---
        function exportarExcel() {
            const data = calcularCorte(subVistaCorte, fechaFiltroCorte);
            // El \uFEFF es el BOM para que Excel lea acentos correctamente
            let csvContent = "\uFEFFFecha,Hora,Categor√≠a,Descripci√≥n,M√©todo,Ingreso,Gasto\n";

            data.lista.forEach(m => {
                const fechaParts = m.fecha.split('T');
                const fecha = fechaParts[0];
                const hora = fechaParts[1] || '';
                
                // Limpiar textos para no romper el CSV
                const cat = (m.cat || '').replace(/,/g, '');
                const desc = (m.desc || '').replace(/,/g, ' '); // Quitar comas de descripciones
                const metodo = (m.metodo || '').replace(/,/g, '');
                
                // Separar ingreso y gasto
                const ingreso = m.tipo === 'ingreso' ? m.monto : 0;
                const gasto = m.tipo === 'gasto' ? m.monto : 0;

                csvContent += `${fecha},${hora},${cat},${desc},${metodo},${ingreso},${gasto}\n`;
            });

            // Crear link de descarga invisible
            const encodedUri = encodeURI("data:text/csv;charset=utf-8," + csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Reporte_FinanceElite_${fechaFiltroCorte}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- L√ìGICA EST√ÅNDAR ---
        function updateNombre(v) { config.nombre = v; save(); render(); }
        function registrar() {
            const m = document.getElementById('monto').value; const fecha = document.getElementById('fecha_mov').value;
            if(!m) return alert('Ingresa monto');
            if(tipoActual === 'abono'){
                const origen = document.getElementById('metodo_origen').value; const destino = document.getElementById('metodo').value;
                movimientos.unshift({ monto: m, tipo: 'gasto', cat: 'Pago Tarjeta', metodo: origen, fecha: fecha });
                movimientos.unshift({ monto: m, tipo: 'ingreso', cat: 'Abono Deuda', metodo: destino, fecha: fecha });
            } else {
                const met = document.getElementById('metodo').value; const cat = document.getElementById('cat').value;
                movimientos.unshift({ monto: m, tipo: tipoActual, cat: cat, metodo: met, desc: document.getElementById('desc').value, fecha: fecha });
            }
            save(); render();
        }
        function procesarRecurrentes() {
            if(!confirm("¬øRegistrar suscripciones?")) return;
            const hoy = new Date(); const year = hoy.getFullYear(); const month = String(hoy.getMonth() + 1).padStart(2, '0');
            config.recurrentes.forEach(rec => {
                const diaFormato = String(rec.dia).padStart(2, '0'); const fechaGenerada = `${year}-${month}-${diaFormato}T12:00`; 
                movimientos.unshift({ monto: rec.monto, tipo: 'gasto', cat: 'Recurrente', metodo: rec.cuenta, desc: `Cargo: ${rec.nombre}`, fecha: fechaGenerada });
            });
            alert("Listo."); save(); render();
        }
        function editarMovimiento(index) {
            const mov = movimientos[index];
            const nuevoMonto = prompt("Editar Monto:", mov.monto);
            const nuevaDesc = prompt("Editar Nota:", mov.desc || "");
            if (nuevoMonto !== null && nuevaDesc !== null) { movimientos[index].monto = nuevoMonto; movimientos[index].desc = nuevaDesc; save(); render(); }
        }
        function eliminarMovimiento(index) { if(confirm("¬øEliminar?")) { movimientos.splice(index, 1); save(); render(); } }
        function editarCuenta(i) {
            const m = config.metodos[i];
            const nuevoNombre = prompt("Nombre:", m.nombre);
            const nuevoInicial = prompt("Saldo/Deuda Inicial:", m.inicial);
            if (nuevoNombre !== null && nuevoInicial !== null) { config.metodos[i].nombre = nuevoNombre; config.metodos[i].inicial = parseFloat(nuevoInicial); save(); render(); }
        }
        function calcularGlobal() {
            let total = 0, detalles = {};
            config.metodos.forEach(m => { detalles[m.nombre] = { bal: m.inicial ? parseFloat(m.inicial) : 0, in: 0, out: 0 }; if (m.tipo === 'debito') { total += detalles[m.nombre].bal; } });
            movimientos.forEach(mov => {
                const cta = config.metodos.find(x => x.nombre === mov.metodo); if(!cta) return; const monto = parseFloat(mov.monto); if (!detalles[mov.metodo]) return;
                if(mov.tipo === 'ingreso') { detalles[mov.metodo].in += monto; if(cta.tipo === 'debito') { total += monto; detalles[mov.metodo].bal += monto; } else { detalles[mov.metodo].bal -= monto; } } 
                else { detalles[mov.metodo].out += monto; if(cta.tipo === 'debito') { total -= monto; detalles[mov.metodo].bal -= monto; } else { detalles[mov.metodo].bal += monto; } }
            });
            return { totalBalance: total, porMetodo: detalles, detalles };
        }
        function calcularCorte(periodo, fechaRef) {
            let i = 0, g = 0, lista = []; let fechaInicio, fechaFin, rangoTexto; const refDate = new Date(fechaRef + "T00:00:00"); 
            if (periodo === 'dia') { fechaInicio = new Date(refDate); fechaFin = new Date(refDate); fechaFin.setHours(23, 59, 59, 999); rangoTexto = `D√≠a: ${fechaInicio.toLocaleDateString()}`; } 
            else if (periodo === 'semana') { const day = refDate.getDay(); const diff = refDate.getDate() - day + (day === 0 ? -6 : 1); fechaInicio = new Date(refDate); fechaInicio.setDate(diff); fechaInicio.setHours(0,0,0,0); fechaFin = new Date(fechaInicio); fechaFin.setDate(fechaInicio.getDate() + 6); fechaFin.setHours(23,59,59,999); rangoTexto = `Semana: ${fechaInicio.getDate()}/${fechaInicio.getMonth()+1} al ${fechaFin.getDate()}/${fechaFin.getMonth()+1}`; } 
            else { fechaInicio = new Date(refDate.getFullYear(), refDate.getMonth(), 1); fechaFin = new Date(refDate.getFullYear(), refDate.getMonth() + 1, 0); fechaFin.setHours(23,59,59,999); rangoTexto = `Mes: ${fechaInicio.toLocaleString('default', { month: 'long', year: 'numeric' })}`; }
            movimientos.forEach((m, originalIndex) => { const movDate = new Date(m.fecha); if (movDate >= fechaInicio && movDate <= fechaFin) { if(m.tipo==='ingreso') i+=parseFloat(m.monto); else g+=parseFloat(m.monto); lista.push({...m, index: originalIndex}); } });
            return { ingresos: i, gastos: g, neto: i - g, lista, rangoTexto };
        }
        function save() { localStorage.setItem('e360_config', JSON.stringify(config)); localStorage.setItem('e360_movs', JSON.stringify(movimientos)); }
        function cambiarVista(v) { vistaActual = v; window.scrollTo(0,0); render(); }
        function addItemMetodo() { const n = document.getElementById('newCta').value; const t = document.getElementById('ctaTipo').value; const init = document.getElementById('ctaInicial').value; if(n){ config.metodos.push({nombre:n, tipo:t, inicial: init || 0}); save(); render(); } }
        function addRecurrente() { const n = document.getElementById('recNom').value, m = document.getElementById('recMon').value, c = document.getElementById('recCta').value, d = document.getElementById('recDia').value; if(n && m && d){ config.recurrentes.push({nombre:n, monto:m, cuenta:c, dia:d}); save(); render(); } }
        function addItem(key, id) { const v = document.getElementById(id).value; if(v){ config[key].push(v); save(); render(); } }
        function removeItem(key, i) { config[key].splice(i, 1); save(); render(); }
        function agregarMeta(tipo) { const n = document.getElementById('meta_nombre').value, m = document.getElementById('meta_monto').value, f = document.getElementById('meta_fecha').value; if(n && m && f) { config.metas.push({nombre:n, monto:m, fecha:f, tipo:tipo}); save(); vistaActual='home'; render(); } }
        function borrarMeta(i) { config.metas.splice(i,1); save(); render(); }

        render();
    </script>
</body>
</html>
